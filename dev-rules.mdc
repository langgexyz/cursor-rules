# å¼€å‘è§„èŒƒ

> **æœ¬æ–‡æ¡£æ˜¯é€šç”¨çš„å¼€å‘è§„èŒƒ**ï¼ŒåŒ…å«Bugæ’æŸ¥ã€ä»£ç ä¿®æ”¹ã€TypeScriptè§„èŒƒã€æµ‹è¯•è§„èŒƒç­‰ã€‚

---

## Bugæ’æŸ¥ä¸éªŒè¯è§„èŒƒ

### æ ¸å¿ƒåŸåˆ™

**é€šè¿‡éªŒè¯é€æ­¥ç¼©å°é—®é¢˜èŒƒå›´ï¼Œè®©ç”¨æˆ·çœ‹åˆ°å®Œæ•´çš„åˆ†æè¿‡ç¨‹**

æ’æŸ¥bugæ—¶ï¼Œä¸èƒ½ç›´æ¥çŒœæµ‹æˆ–è·³è·ƒå¼åˆ†æï¼Œå¿…é¡»é€šè¿‡å®é™…éªŒè¯æ¥é€æ­¥ç¡®å®šé—®é¢˜å‡ºåœ¨å“ªä¸€å±‚ã€‚

### âŒ ç¦æ­¢çš„é”™è¯¯æ¨¡å¼

```
ç”¨æˆ·ï¼šXåŠŸèƒ½æœ‰bug
AIï¼šæˆ‘è§‰å¾—å¯èƒ½æ˜¯Yçš„é—®é¢˜ï¼ˆæœªéªŒè¯ï¼‰
    å»ºè®®æ”¹Zï¼ˆç›´æ¥ç»™æ–¹æ¡ˆï¼‰

ç»“æœï¼šæ–¹æ¡ˆåŸºäºçŒœæµ‹ï¼Œå¯èƒ½å—è¾•åŒ—è¾™
```

### âœ… æ­£ç¡®çš„æ’æŸ¥æµç¨‹

```
ç”¨æˆ·ï¼šXåŠŸèƒ½æœ‰bug
AIï¼š
  1. ç†è§£é—®é¢˜ï¼šå¤è¿°é—®é¢˜ï¼Œç¡®è®¤ç†è§£æ­£ç¡®
  2. å‡è®¾éªŒè¯ï¼šæå‡º2-3ä¸ªå¯èƒ½çš„åŸå› å‡è®¾
  3. é€å±‚éªŒè¯ï¼šä»æœ€åº•å±‚å¼€å§‹éªŒè¯
  
     éªŒè¯1ï¼šDBå±‚ - æŸ¥è¯¢æ•°æ®åº“ï¼Œæ•°æ®æ˜¯å¦å­˜åœ¨ï¼Ÿ
     ç»“è®º1ï¼šâœ… æ•°æ®å­˜åœ¨ / âŒ æ•°æ®ç¼ºå¤±
     
     éªŒè¯2ï¼šAPIå±‚ - è°ƒç”¨æ¥å£ï¼Œèƒ½å¦æ­£ç¡®è¿”å›ï¼Ÿ
     ç»“è®º2ï¼šâœ… æ¥å£æ­£å¸¸ / âŒ æ¥å£å¼‚å¸¸
     
     éªŒè¯3ï¼šå‰ç«¯å±‚ - æŸ¥çœ‹é¡µé¢ï¼Œæ•°æ®æ˜¯å¦æ˜¾ç¤ºï¼Ÿ
     ç»“è®º3ï¼šâœ… æ˜¾ç¤ºæ­£å¸¸ / âŒ æ˜¾ç¤ºå¼‚å¸¸
  
  4. å®šä½é—®é¢˜ï¼šæ ¹æ®éªŒè¯ç»“æœï¼Œæ˜ç¡®æŒ‡å‡ºé—®é¢˜åœ¨å“ªä¸€å±‚
  5. åˆ†æåŸå› ï¼šé˜…è¯»ç›¸å…³ä»£ç ï¼Œæ‰¾å‡ºæ ¹æœ¬åŸå› 
  6. åˆ¶å®šæ–¹æ¡ˆï¼šæå‡ºä¿®å¤æ–¹æ¡ˆï¼Œç­‰å¾…ç”¨æˆ·ç¡®è®¤
  7. å®æ–½ä¿®å¤ï¼šè·å¾—ç¡®è®¤åæ‰§è¡Œä¿®æ”¹
```

### é€å±‚éªŒè¯æ–¹æ³•

#### ç¬¬1å±‚ï¼šæ•°æ®å±‚éªŒè¯ï¼ˆDB Layerï¼‰

**ç›®çš„**ï¼šç¡®è®¤æ•°æ®æœ¬èº«æ˜¯å¦å­˜åœ¨ã€æ˜¯å¦æ­£ç¡®

```bash
# éªŒè¯æ•°æ®æ˜¯å¦å­˜åœ¨
node -e "
const mysql = require('mysql2/promise');
(async () => {
  const conn = await mysql.createConnection({...});
  const [rows] = await conn.execute('SELECT * FROM users WHERE id = ?', ['123']);
  console.table(rows);
  await conn.end();
})();
"
```

**è¾“å‡ºæ ¼å¼**ï¼š
```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ” ç¬¬1æ­¥ï¼šDBå±‚éªŒè¯
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
æŸ¥è¯¢ï¼šSELECT * FROM users WHERE id = '123'
ç»“æœï¼šâœ… æ‰¾åˆ° 1 æ¡è®°å½•
[æ˜¾ç¤ºæ•°æ®è¡¨æ ¼]

ç»“è®ºï¼šDBå±‚æ•°æ®æ­£å¸¸ âœ“
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

#### ç¬¬2å±‚ï¼šAPIå±‚éªŒè¯

**ç›®çš„**ï¼šç¡®è®¤åç«¯æ¥å£æ˜¯å¦èƒ½æ­£ç¡®å¤„ç†å’Œè¿”å›æ•°æ®

```bash
# éªŒè¯APIæ˜¯å¦æ­£å¸¸
curl --max-time 5 \
  "http://localhost:18100/api/users/123" \
  -H "Authorization: Bearer ${TOKEN}"
```

**è¾“å‡ºæ ¼å¼**ï¼š
```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ” ç¬¬2æ­¥ï¼šAPIå±‚éªŒè¯
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
è¯·æ±‚ï¼šGET /api/users/123
å“åº”ï¼š{"success": true, "data": {...}}

ç»“è®ºï¼š
- DBå±‚ï¼šâœ… æ•°æ®å­˜åœ¨
- APIå±‚ï¼šâœ… æ¥å£æ­£å¸¸è¿”å›

é—®é¢˜èŒƒå›´ç¼©å°è‡³ï¼šå‰ç«¯å±‚
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

#### ç¬¬3å±‚ï¼šå‰ç«¯å±‚éªŒè¯

**ç›®çš„**ï¼šç¡®è®¤å‰ç«¯æ˜¯å¦æ­£ç¡®æ¥æ”¶å’Œæ˜¾ç¤ºæ•°æ®

```typescript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œ
console.log('å‰ç«¯çŠ¶æ€:', {
  apiResponse: window.lastApiResponse,
  displayedData: document.querySelector('.user-item')?.textContent
});
```

### èŒƒå›´ç¼©å°ç­–ç•¥

ä½¿ç”¨äºŒåˆ†æ³•é€æ­¥ç¼©å°é—®é¢˜èŒƒå›´ï¼š

```
å…¨é“¾è·¯ï¼šæµè§ˆå™¨ â†’ å‰ç«¯ä»£ç  â†’ APIè¯·æ±‚ â†’ åç«¯ä»£ç  â†’ æ•°æ®åº“

ç¬¬1æ¬¡éªŒè¯ï¼šæ£€æŸ¥æ•°æ®åº“
  - âœ… æ•°æ®å­˜åœ¨ â†’ é—®é¢˜åœ¨ä¸Šå±‚
  - âŒ æ•°æ®ä¸å­˜åœ¨ â†’ é—®é¢˜å®šä½ï¼šæ•°æ®å†™å…¥é€»è¾‘

ç¬¬2æ¬¡éªŒè¯ï¼šæ£€æŸ¥API
  - âœ… APIæ­£å¸¸ â†’ é—®é¢˜åœ¨å‰ç«¯
  - âŒ APIå¼‚å¸¸ â†’ é—®é¢˜åœ¨åç«¯

ç¬¬3æ¬¡éªŒè¯ï¼šæ£€æŸ¥å‰ç«¯
  - æ‰¾åˆ°å…·ä½“çš„æ–‡ä»¶ã€å‡½æ•°ã€ä»£ç è¡Œ
```

---

## ä»£ç ä¿®æ”¹é˜²é—æ¼è§„èŒƒ

### æ ¸å¿ƒåŸåˆ™

ä»»ä½•ä»£ç ä¿®æ”¹å‰å¿…é¡»æ‰§è¡Œå®Œæ•´æ€§æ£€æŸ¥ï¼Œç¡®ä¿ä¸€æ¬¡æ€§å®Œæˆæ‰€æœ‰ç›¸å…³ä¿®æ”¹ï¼Œé¿å…ç¢ç‰‡åŒ–æäº¤ã€‚

### äº”å±‚æ£€æŸ¥æ³•

è§ `core-rules.mdc` ä¸­çš„"ä»£ç å®Œæ•´æ€§æ ‡å‡†"ç« èŠ‚ã€‚

### æ£€æŸ¥æ¸…å•

**éªŒè¯ç¯èŠ‚**
- [ ] æ¯ä¸ªå‡è®¾éƒ½é€šè¿‡å®é™…éªŒè¯
- [ ] éªŒè¯ç»“æœä»¥ç»“æ„åŒ–æ ¼å¼è¾“å‡º
- [ ] ä½¿ç”¨ âœ…/âŒ æ˜ç¡®æ ‡æ³¨éªŒè¯ç»“è®º
- [ ] æ¯æ¬¡éªŒè¯åè¯´æ˜å½“å‰é—®é¢˜èŒƒå›´

**åˆ†æç¯èŠ‚**
- [ ] åˆ—å‡º2-3ä¸ªå¯èƒ½çš„åŸå› å‡è®¾
- [ ] ä»åº•å±‚ï¼ˆDBï¼‰åˆ°ä¸Šå±‚ï¼ˆå‰ç«¯ï¼‰é€å±‚éªŒè¯
- [ ] å®šä½åˆ°å…·ä½“çš„ä»£ç æ–‡ä»¶å’Œè¡Œå·

---

## TypeScript ç±»å‹å®‰å…¨è§„èŒƒ

### æ ¸å¿ƒåŸåˆ™

**ä¸¥æ ¼ç¦æ­¢ä½¿ç”¨ `any` ç±»å‹**

### è§„åˆ™

1. **ç¦æ­¢ `any`**
   ```typescript
   // âŒ é”™è¯¯
   function handleData(data: any) { ... }
   
   // âœ… æ­£ç¡®
   function handleData(data: UserData) { ... }
   ```

2. **å‡½æ•°å¿…é¡»å£°æ˜ç±»å‹**
   ```typescript
   // âŒ é”™è¯¯
   function calculate(a, b) { return a + b; }
   
   // âœ… æ­£ç¡®
   function calculate(a: number, b: number): number { return a + b; }
   ```

3. **ä½¿ç”¨ `unknown` ä»£æ›¿ `any`**
   ```typescript
   // âœ… éœ€è¦ç±»å‹å®ˆå«
   function processData(data: unknown) {
     if (typeof data === 'string') {
       return data.toUpperCase();
     }
   }
   ```

4. **å……åˆ†åˆ©ç”¨æ³›å‹**
   ```typescript
   // âœ… ä¿æŒç±»å‹å®‰å…¨
   function fetchData<T>(url: string): Promise<ApiResponse<T>> { ... }
   ```

### å¸¸è§åœºæ™¯

| åœºæ™¯ | é”™è¯¯åšæ³• | æ­£ç¡®åšæ³• |
|------|---------|---------|
| APIå“åº” | `response: any` | `response: ApiResponse<UserData>` |
| äº‹ä»¶å¤„ç† | `event: any` | `event: React.ChangeEvent<HTMLInputElement>` |
| é…ç½®å¯¹è±¡ | `config: any` | `config: AppConfig` |
| ç¬¬ä¸‰æ–¹åº“ | ä½¿ç”¨ `any` | å®šä¹‰ `.d.ts` ç±»å‹æ–‡ä»¶ |

---

## React å¼€å‘è§„èŒƒ

### ç»„ä»¶è§„èŒƒ

**ç»„ä»¶å‘½å**ï¼š
- ä½¿ç”¨ PascalCase
- æ–‡ä»¶åä¸ç»„ä»¶åä¸€è‡´
- ä¸€ä¸ªæ–‡ä»¶ä¸€ä¸ªä¸»ç»„ä»¶

**Props ç±»å‹**ï¼š
```typescript
// âœ… å®šä¹‰æ¸…æ™°çš„ Props æ¥å£
interface UserCardProps {
  user: User;
  onEdit?: (id: string) => void;
  className?: string;
}

const UserCard: React.FC<UserCardProps> = ({ user, onEdit, className }) => {
  // ...
};
```

### Hooks è§„èŒƒ

**useState**ï¼š
```typescript
// âœ… æ˜ç¡®ç±»å‹
const [user, setUser] = useState<User | null>(null);
```

**useEffect**ï¼š
```typescript
// âœ… æ˜ç¡®ä¾èµ–é¡¹
useEffect(() => {
  fetchData();
}, [userId]); // ä¾èµ–é¡¹æ¸…æ™°
```

**è‡ªå®šä¹‰ Hook**ï¼š
```typescript
// âœ… è¿”å›ç±»å‹æ˜ç¡®
function useUser(id: string): { user: User | null; loading: boolean; error: Error | null } {
  // ...
  return { user, loading, error };
}
```

### æ€§èƒ½ä¼˜åŒ–

- ä½¿ç”¨ `React.memo` ä¼˜åŒ–ç»„ä»¶æ¸²æŸ“
- ä½¿ç”¨ `useMemo` ç¼“å­˜è®¡ç®—ç»“æœ
- ä½¿ç”¨ `useCallback` ç¼“å­˜å›è°ƒå‡½æ•°
- é¿å…åœ¨æ¸²æŸ“å‡½æ•°ä¸­åˆ›å»ºæ–°å¯¹è±¡/å‡½æ•°

---

## API è®¾è®¡è§„èŒƒ

### RESTful è§„èŒƒ

| æ“ä½œ | HTTPæ–¹æ³• | è·¯å¾„ç¤ºä¾‹ | è¯´æ˜ |
|------|---------|---------|------|
| åˆ—è¡¨ | GET | `/api/users` | æŸ¥è¯¢åˆ—è¡¨ |
| è¯¦æƒ… | GET | `/api/users/:id` | æŸ¥è¯¢è¯¦æƒ… |
| åˆ›å»º | POST | `/api/users` | åˆ›å»ºèµ„æº |
| æ›´æ–° | PUT | `/api/users/:id` | å®Œæ•´æ›´æ–° |
| éƒ¨åˆ†æ›´æ–° | PATCH | `/api/users/:id` | éƒ¨åˆ†æ›´æ–° |
| åˆ é™¤ | DELETE | `/api/users/:id` | åˆ é™¤èµ„æº |

### å“åº”æ ¼å¼

```typescript
// âœ… ç»Ÿä¸€çš„å“åº”æ ¼å¼
interface ApiResponse<T> {
  success: boolean;
  data?: T;
  error?: {
    code: string;
    message: string;
  };
}
```

### é”™è¯¯å¤„ç†

```typescript
// âœ… ç»Ÿä¸€çš„é”™è¯¯ç 
enum ErrorCode {
  UNAUTHORIZED = 'UNAUTHORIZED',
  NOT_FOUND = 'NOT_FOUND',
  VALIDATION_ERROR = 'VALIDATION_ERROR',
  INTERNAL_ERROR = 'INTERNAL_ERROR',
}
```

---

## æµ‹è¯•è§„èŒƒ

### å•å…ƒæµ‹è¯•

```typescript
// âœ… æ¸…æ™°çš„æµ‹è¯•ç”¨ä¾‹
describe('UserService', () => {
  describe('createUser', () => {
    it('should create user with valid data', async () => {
      // Arrange
      const userData = { name: 'John', email: 'john@example.com' };
      
      // Act
      const result = await userService.createUser(userData);
      
      // Assert
      expect(result).toBeDefined();
      expect(result.name).toBe('John');
    });
    
    it('should throw error with invalid email', async () => {
      const userData = { name: 'John', email: 'invalid' };
      await expect(userService.createUser(userData)).rejects.toThrow();
    });
  });
});
```

### é›†æˆæµ‹è¯•

- æµ‹è¯•å®Œæ•´çš„ç”¨æˆ·æ“ä½œæµç¨‹
- ä»ç”¨æˆ·ç™»å½•åˆ°åŠŸèƒ½ä½¿ç”¨çš„å®Œæ•´è·¯å¾„
- éªŒè¯å¤šä¸ªæ¨¡å—ä¹‹é—´çš„äº¤äº’

---

## æ€§èƒ½ä¼˜åŒ–è§„èŒƒ

### å‰ç«¯æ€§èƒ½

1. **ä»£ç åˆ†å‰²**ï¼šä½¿ç”¨åŠ¨æ€ import
2. **æ‡’åŠ è½½**ï¼šè·¯ç”±çº§åˆ«çš„æ‡’åŠ è½½
3. **å›¾ç‰‡ä¼˜åŒ–**ï¼šä½¿ç”¨ WebP æ ¼å¼ã€æ‡’åŠ è½½
4. **ç¼“å­˜ç­–ç•¥**ï¼šåˆç†ä½¿ç”¨æµè§ˆå™¨ç¼“å­˜

### åç«¯æ€§èƒ½

1. **æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–**ï¼š
   - æ·»åŠ å¿…è¦çš„ç´¢å¼•
   - é¿å… N+1 æŸ¥è¯¢
   - ä½¿ç”¨åˆ†é¡µ

2. **APIå“åº”ä¼˜åŒ–**ï¼š
   - åªè¿”å›å¿…è¦çš„å­—æ®µ
   - ä½¿ç”¨ç¼“å­˜ï¼ˆRedisï¼‰
   - å‹ç¼©å“åº”æ•°æ®

---

## å®‰å…¨è§„èŒƒ

### è¾“å…¥éªŒè¯

```typescript
// âœ… æœåŠ¡ç«¯å¿…é¡»éªŒè¯æ‰€æœ‰è¾“å…¥
@Post('/users')
@Validate()
async createUser(@Body() userData: CreateUserDTO) {
  // userData å·²ç»è¿‡éªŒè¯
}
```

### è®¤è¯æˆæƒ

```typescript
// âœ… ä½¿ç”¨è£…é¥°å™¨è¿›è¡Œæƒé™æ§åˆ¶
@Get('/admin/users')
@UseGuard(AuthGuard)
@RequireRole('admin')
async getUsers() {
  // ä»…ç®¡ç†å‘˜å¯è®¿é—®
}
```

### æ•æ„Ÿä¿¡æ¯å¤„ç†

- å¯†ç å¿…é¡»åŠ å¯†å­˜å‚¨
- Token ä½¿ç”¨ JWT å¹¶è®¾ç½®è¿‡æœŸæ—¶é—´
- æ—¥å¿—ä¸­ä¸è¾“å‡ºæ•æ„Ÿä¿¡æ¯
- API è¿”å›æ—¶è¿‡æ»¤æ•æ„Ÿå­—æ®µ

---

**è§„èŒƒç»“æŸ**

> æœ¬è§„èŒƒé€‚ç”¨äºæ‰€æœ‰é¡¹ç›®ï¼Œå¯æ ¹æ®æŠ€æœ¯æ ˆé€‚å½“è°ƒæ•´ã€‚é¡¹ç›®ç‰¹å®šè§„èŒƒè¯·åœ¨ `project-spec.mdc` ä¸­å®šä¹‰ã€‚
